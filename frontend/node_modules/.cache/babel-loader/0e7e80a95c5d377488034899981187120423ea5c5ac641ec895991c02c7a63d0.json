{"ast":null,"code":"import { ref, reactive, onMounted } from 'vue';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport axios from 'axios';\nexport default {\n  name: 'AdminExchange',\n  setup() {\n    const activeTab = ref('products');\n    const products = ref([]);\n    const allProducts = ref([]);\n    const exchangeRecords = ref([]);\n    const currentRecord = ref(null);\n    const productFormRef = ref();\n    const productDialogVisible = ref(false);\n    const recordDialogVisible = ref(false);\n    const isEdit = ref(false);\n    const productMap = ref(new Map());\n    const filterForm = reactive({\n      keyword: '',\n      status: ''\n    });\n    const recordFilterForm = reactive({\n      productId: '',\n      keyword: '',\n      dateRange: []\n    });\n    const productForm = reactive({\n      productName: '',\n      description: '',\n      pointsRequired: null,\n      stockQuantity: null,\n      imageUrl: '',\n      status: 'ACTIVE'\n    });\n    const pagination = reactive({\n      current: 1,\n      size: 10,\n      total: 0\n    });\n    const recordPagination = reactive({\n      current: 1,\n      size: 10,\n      total: 0\n    });\n    const productRules = {\n      productName: [{\n        required: true,\n        message: '请输入商品名称',\n        trigger: 'blur'\n      }],\n      description: [{\n        required: true,\n        message: '请输入商品描述',\n        trigger: 'blur'\n      }],\n      pointsRequired: [{\n        required: true,\n        message: '请输入所需积分',\n        trigger: 'blur'\n      }],\n      stockQuantity: [{\n        required: true,\n        message: '请输入库存数量',\n        trigger: 'blur'\n      }],\n      status: [{\n        required: true,\n        message: '请选择状态',\n        trigger: 'change'\n      }]\n    };\n    const loadProducts = async () => {\n      try {\n        const params = {\n          current: pagination.current,\n          size: pagination.size,\n          keyword: filterForm.keyword || undefined\n        };\n        const response = await axios.get('/api/exchange/products/manage', {\n          params\n        });\n        if (response.data.code === 200) {\n          products.value = response.data.data.records || [];\n          pagination.total = response.data.data.total || 0;\n        }\n      } catch (error) {\n        ElMessage.error('获取商品列表失败');\n      }\n    };\n    const loadAllProducts = async () => {\n      try {\n        const response = await axios.get('/api/exchange/products');\n        if (response.data.code === 200) {\n          allProducts.value = response.data.data;\n\n          // 构建商品映射\n          allProducts.value.forEach(product => {\n            productMap.value.set(product.id, product.productName);\n          });\n        }\n      } catch (error) {\n        console.error('获取所有商品失败', error);\n      }\n    };\n    const loadExchangeRecords = async () => {\n      try {\n        const params = {\n          current: recordPagination.current,\n          size: recordPagination.size,\n          productId: recordFilterForm.productId || undefined,\n          keyword: recordFilterForm.keyword || undefined\n        };\n        if (recordFilterForm.dateRange && recordFilterForm.dateRange.length === 2) {\n          params.startDate = recordFilterForm.dateRange[0];\n          params.endDate = recordFilterForm.dateRange[1];\n        }\n        const response = await axios.get('/api/exchange/records/list', {\n          params\n        });\n        if (response.data.code === 200) {\n          exchangeRecords.value = response.data.data.records || [];\n          recordPagination.total = response.data.data.total || 0;\n        }\n      } catch (error) {\n        ElMessage.error('获取兑换记录失败');\n      }\n    };\n    const resetFilter = () => {\n      filterForm.keyword = '';\n      filterForm.status = '';\n      pagination.current = 1;\n      loadProducts();\n    };\n    const resetRecordFilter = () => {\n      recordFilterForm.productId = '';\n      recordFilterForm.keyword = '';\n      recordFilterForm.dateRange = [];\n      recordPagination.current = 1;\n      loadExchangeRecords();\n    };\n    const handleSizeChange = size => {\n      pagination.size = size;\n      pagination.current = 1;\n      loadProducts();\n    };\n    const handleCurrentChange = current => {\n      pagination.current = current;\n      loadProducts();\n    };\n    const handleRecordSizeChange = size => {\n      recordPagination.size = size;\n      recordPagination.current = 1;\n      loadExchangeRecords();\n    };\n    const handleRecordCurrentChange = current => {\n      recordPagination.current = current;\n      loadExchangeRecords();\n    };\n    const handleCreateProduct = () => {\n      isEdit.value = false;\n      productForm.productName = '';\n      productForm.description = '';\n      productForm.pointsRequired = null;\n      productForm.stockQuantity = null;\n      productForm.imageUrl = '';\n      productForm.status = 'ACTIVE';\n      productDialogVisible.value = true;\n    };\n    const handleEditProduct = product => {\n      isEdit.value = true;\n      Object.assign(productForm, product);\n      productDialogVisible.value = true;\n    };\n    const handleSaveProduct = async () => {\n      try {\n        await productFormRef.value.validate();\n        let response;\n        if (isEdit.value) {\n          response = await axios.put(`/api/exchange/products/${productForm.id}`, productForm);\n        } else {\n          response = await axios.post('/api/exchange/products', productForm);\n        }\n        if (response.data.code === 200) {\n          ElMessage.success(isEdit.value ? '更新成功' : '创建成功');\n          productDialogVisible.value = false;\n          loadProducts();\n          loadAllProducts();\n        } else {\n          ElMessage.error(response.data.message || '操作失败');\n        }\n      } catch (error) {\n        ElMessage.error('操作失败');\n      }\n    };\n    const handleToggleStatus = async product => {\n      try {\n        const newStatus = product.status === 'ACTIVE' ? 'INACTIVE' : 'ACTIVE';\n        const response = await axios.put(`/api/exchange/products/${product.id}`, {\n          ...product,\n          status: newStatus\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(newStatus === 'ACTIVE' ? '上架成功' : '下架成功');\n          loadProducts();\n        } else {\n          ElMessage.error(response.data.message || '操作失败');\n        }\n      } catch (error) {\n        ElMessage.error('操作失败');\n      }\n    };\n    const handleDeleteProduct = async product => {\n      try {\n        await ElMessageBox.confirm(`确定要删除商品 ${product.productName} 吗？`, '确认删除', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        const response = await axios.delete(`/api/exchange/products/${product.id}`);\n        if (response.data.code === 200) {\n          ElMessage.success('删除成功');\n          loadProducts();\n          loadAllProducts();\n        } else {\n          ElMessage.error(response.data.message || '删除失败');\n        }\n      } catch (error) {\n        if (error !== 'cancel') {\n          ElMessage.error('删除失败');\n        }\n      }\n    };\n    const handleViewRecord = record => {\n      currentRecord.value = record;\n      recordDialogVisible.value = true;\n    };\n    const getProductName = productId => {\n      return productMap.value.get(productId) || '未知商品';\n    };\n    const formatTime = time => {\n      return new Date(time).toLocaleString();\n    };\n    onMounted(() => {\n      loadProducts();\n      loadAllProducts();\n      loadExchangeRecords();\n    });\n    return {\n      activeTab,\n      products,\n      allProducts,\n      exchangeRecords,\n      currentRecord,\n      productFormRef,\n      productDialogVisible,\n      recordDialogVisible,\n      isEdit,\n      filterForm,\n      recordFilterForm,\n      productForm,\n      pagination,\n      recordPagination,\n      productRules,\n      loadProducts,\n      loadExchangeRecords,\n      resetFilter,\n      resetRecordFilter,\n      handleSizeChange,\n      handleCurrentChange,\n      handleRecordSizeChange,\n      handleRecordCurrentChange,\n      handleCreateProduct,\n      handleEditProduct,\n      handleSaveProduct,\n      handleToggleStatus,\n      handleDeleteProduct,\n      handleViewRecord,\n      getProductName,\n      formatTime\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","ElMessage","ElMessageBox","axios","name","setup","activeTab","products","allProducts","exchangeRecords","currentRecord","productFormRef","productDialogVisible","recordDialogVisible","isEdit","productMap","Map","filterForm","keyword","status","recordFilterForm","productId","dateRange","productForm","productName","description","pointsRequired","stockQuantity","imageUrl","pagination","current","size","total","recordPagination","productRules","required","message","trigger","loadProducts","params","undefined","response","get","data","code","value","records","error","loadAllProducts","forEach","product","set","id","console","loadExchangeRecords","length","startDate","endDate","resetFilter","resetRecordFilter","handleSizeChange","handleCurrentChange","handleRecordSizeChange","handleRecordCurrentChange","handleCreateProduct","handleEditProduct","Object","assign","handleSaveProduct","validate","put","post","success","handleToggleStatus","newStatus","handleDeleteProduct","confirm","confirmButtonText","cancelButtonText","type","delete","handleViewRecord","record","getProductName","formatTime","time","Date","toLocaleString"],"sources":["/Users/libra520/JavaProject/repast-vip-system/frontend/src/views/admin/Exchange.vue"],"sourcesContent":["<template>\n  <div class=\"exchange\">\n    <el-card>\n      <template #header>\n        <div class=\"card-header\">\n          <span>积分兑换管理</span>\n          <el-button type=\"primary\" @click=\"handleCreateProduct\">新增商品</el-button>\n        </div>\n      </template>\n\n      <!-- 商品管理标签页 -->\n      <el-tabs v-model=\"activeTab\">\n        <!-- 商品列表 -->\n        <el-tab-pane label=\"商品管理\" name=\"products\">\n          <!-- 筛选条件 -->\n          <div class=\"filter-section\">\n            <el-form :inline=\"true\" :model=\"filterForm\" class=\"filter-form\">\n              <el-form-item label=\"商品名称\">\n                <el-input v-model=\"filterForm.keyword\" placeholder=\"请输入商品名称\" clearable />\n              </el-form-item>\n              <el-form-item label=\"状态\">\n                <el-select v-model=\"filterForm.status\" placeholder=\"全部状态\" clearable>\n                  <el-option label=\"上架\" value=\"ACTIVE\" />\n                  <el-option label=\"下架\" value=\"INACTIVE\" />\n                </el-select>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" @click=\"loadProducts\">查询</el-button>\n                <el-button @click=\"resetFilter\">重置</el-button>\n              </el-form-item>\n            </el-form>\n          </div>\n\n          <!-- 商品列表 -->\n          <el-table :data=\"products\" style=\"width: 100%\">\n            <el-table-column prop=\"productName\" label=\"商品名称\" width=\"200\" />\n            <el-table-column prop=\"description\" label=\"描述\" min-width=\"250\" />\n            <el-table-column prop=\"pointsRequired\" label=\"所需积分\" width=\"120\" />\n            <el-table-column prop=\"stockQuantity\" label=\"库存\" width=\"100\">\n              <template #default=\"scope\">\n                <span :class=\"{ 'low-stock': scope.row.stockQuantity <= 10 }\">\n                  {{ scope.row.stockQuantity }}\n                </span>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"exchangeCount\" label=\"兑换次数\" width=\"100\" />\n            <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\n              <template #default=\"scope\">\n                <el-tag :type=\"scope.row.status === 'ACTIVE' ? 'success' : 'danger'\">\n                  {{ scope.row.status === 'ACTIVE' ? '上架' : '下架' }}\n                </el-tag>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"180\">\n              <template #default=\"scope\">\n                {{ formatTime(scope.row.createTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n              <template #default=\"scope\">\n                <el-button type=\"primary\" size=\"small\" @click=\"handleEditProduct(scope.row)\">\n                  编辑\n                </el-button>\n                <el-button \n                  :type=\"scope.row.status === 'ACTIVE' ? 'warning' : 'success'\" \n                  size=\"small\" \n                  @click=\"handleToggleStatus(scope.row)\"\n                >\n                  {{ scope.row.status === 'ACTIVE' ? '下架' : '上架' }}\n                </el-button>\n                <el-button type=\"danger\" size=\"small\" @click=\"handleDeleteProduct(scope.row)\">\n                  删除\n                </el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n\n          <!-- 分页 -->\n          <div class=\"pagination\">\n            <el-pagination\n              v-model:current-page=\"pagination.current\"\n              v-model:page-size=\"pagination.size\"\n              :page-sizes=\"[10, 20, 50, 100]\"\n              :total=\"pagination.total\"\n              layout=\"total, sizes, prev, pager, next, jumper\"\n              @size-change=\"handleSizeChange\"\n              @current-change=\"handleCurrentChange\"\n            />\n          </div>\n        </el-tab-pane>\n\n        <!-- 兑换记录 -->\n        <el-tab-pane label=\"兑换记录\" name=\"records\">\n          <!-- 兑换记录筛选 -->\n          <div class=\"filter-section\">\n            <el-form :inline=\"true\" :model=\"recordFilterForm\" class=\"filter-form\">\n              <el-form-item label=\"商品\">\n                <el-select v-model=\"recordFilterForm.productId\" placeholder=\"全部商品\" clearable>\n                  <el-option\n                    v-for=\"product in allProducts\"\n                    :key=\"product.id\"\n                    :label=\"product.productName\"\n                    :value=\"product.id\"\n                  />\n                </el-select>\n              </el-form-item>\n              <el-form-item label=\"领取信息\">\n                <el-input v-model=\"recordFilterForm.keyword\" placeholder=\"请输入领取信息\" clearable />\n              </el-form-item>\n              <el-form-item label=\"兑换时间\">\n                <el-date-picker\n                  v-model=\"recordFilterForm.dateRange\"\n                  type=\"daterange\"\n                  range-separator=\"至\"\n                  start-placeholder=\"开始日期\"\n                  end-placeholder=\"结束日期\"\n                  format=\"YYYY-MM-DD\"\n                  value-format=\"YYYY-MM-DD\"\n                />\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" @click=\"loadExchangeRecords\">查询</el-button>\n                <el-button @click=\"resetRecordFilter\">重置</el-button>\n              </el-form-item>\n            </el-form>\n          </div>\n\n          <!-- 兑换记录列表 -->\n          <el-table :data=\"exchangeRecords\" style=\"width: 100%\">\n            <el-table-column prop=\"productName\" label=\"商品名称\" width=\"200\">\n              <template #default=\"scope\">\n                {{ getProductName(scope.row.productId) }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"memberCode\" label=\"会员号\" width=\"120\">\n              <template #default=\"scope\">\n                {{ scope.row.member?.memberCode }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"username\" label=\"用户名\" width=\"120\">\n              <template #default=\"scope\">\n                {{ scope.row.member?.user?.username }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"pointsUsed\" label=\"使用积分\" width=\"100\">\n              <template #default=\"scope\">\n                <span class=\"points-used\">-{{ scope.row.pointsUsed }}</span>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"receiveInfo\" label=\"领取信息\" min-width=\"200\" />\n            <el-table-column prop=\"exchangeTime\" label=\"兑换时间\" width=\"180\">\n              <template #default=\"scope\">\n                {{ formatTime(scope.row.exchangeTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\" width=\"100\" fixed=\"right\">\n              <template #default=\"scope\">\n                <el-button type=\"primary\" size=\"small\" @click=\"handleViewRecord(scope.row)\">\n                  详情\n                </el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n\n          <!-- 分页 -->\n          <div class=\"pagination\">\n            <el-pagination\n              v-model:current-page=\"recordPagination.current\"\n              v-model:page-size=\"recordPagination.size\"\n              :page-sizes=\"[10, 20, 50, 100]\"\n              :total=\"recordPagination.total\"\n              layout=\"total, sizes, prev, pager, next, jumper\"\n              @size-change=\"handleRecordSizeChange\"\n              @current-change=\"handleRecordCurrentChange\"\n            />\n          </div>\n        </el-tab-pane>\n      </el-tabs>\n    </el-card>\n\n    <!-- 新增/编辑商品对话框 -->\n    <el-dialog \n      v-model=\"productDialogVisible\" \n      :title=\"isEdit ? '编辑商品' : '新增商品'\" \n      width=\"60%\"\n    >\n      <el-form :model=\"productForm\" :rules=\"productRules\" ref=\"productFormRef\" label-width=\"100px\">\n        <el-form-item label=\"商品名称\" prop=\"productName\">\n          <el-input v-model=\"productForm.productName\" placeholder=\"请输入商品名称\" />\n        </el-form-item>\n        <el-form-item label=\"商品描述\" prop=\"description\">\n          <el-input v-model=\"productForm.description\" type=\"textarea\" placeholder=\"请输入商品描述\" />\n        </el-form-item>\n        <el-form-item label=\"所需积分\" prop=\"pointsRequired\">\n          <el-input-number v-model=\"productForm.pointsRequired\" :min=\"1\" style=\"width: 100%\" />\n        </el-form-item>\n        <el-form-item label=\"库存数量\" prop=\"stockQuantity\">\n          <el-input-number v-model=\"productForm.stockQuantity\" :min=\"0\" style=\"width: 100%\" />\n        </el-form-item>\n        <el-form-item label=\"商品图片\" prop=\"imageUrl\">\n          <el-input v-model=\"productForm.imageUrl\" placeholder=\"请输入图片URL\" />\n        </el-form-item>\n        <el-form-item label=\"状态\" prop=\"status\">\n          <el-select v-model=\"productForm.status\" placeholder=\"请选择状态\" style=\"width: 100%\">\n            <el-option label=\"上架\" value=\"ACTIVE\" />\n            <el-option label=\"下架\" value=\"INACTIVE\" />\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"productDialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleSaveProduct\">保存</el-button>\n      </template>\n    </el-dialog>\n\n    <!-- 兑换记录详情对话框 -->\n    <el-dialog v-model=\"recordDialogVisible\" title=\"兑换记录详情\" width=\"50%\">\n      <div v-if=\"currentRecord\" class=\"record-detail\">\n        <el-descriptions :column=\"2\" border>\n          <el-descriptions-item label=\"商品名称\">{{ getProductName(currentRecord.productId) }}</el-descriptions-item>\n          <el-descriptions-item label=\"会员号\">{{ currentRecord.member?.memberCode }}</el-descriptions-item>\n          <el-descriptions-item label=\"用户名\">{{ currentRecord.member?.user?.username }}</el-descriptions-item>\n          <el-descriptions-item label=\"使用积分\">{{ currentRecord.pointsUsed }}</el-descriptions-item>\n          <el-descriptions-item label=\"领取信息\" :span=\"2\">{{ currentRecord.receiveInfo }}</el-descriptions-item>\n          <el-descriptions-item label=\"兑换时间\" :span=\"2\">{{ formatTime(currentRecord.exchangeTime) }}</el-descriptions-item>\n        </el-descriptions>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted } from 'vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport axios from 'axios'\n\nexport default {\n  name: 'AdminExchange',\n  setup() {\n    const activeTab = ref('products')\n    const products = ref([])\n    const allProducts = ref([])\n    const exchangeRecords = ref([])\n    const currentRecord = ref(null)\n    const productFormRef = ref()\n    const productDialogVisible = ref(false)\n    const recordDialogVisible = ref(false)\n    const isEdit = ref(false)\n    const productMap = ref(new Map())\n\n    const filterForm = reactive({\n      keyword: '',\n      status: ''\n    })\n\n    const recordFilterForm = reactive({\n      productId: '',\n      keyword: '',\n      dateRange: []\n    })\n\n    const productForm = reactive({\n      productName: '',\n      description: '',\n      pointsRequired: null,\n      stockQuantity: null,\n      imageUrl: '',\n      status: 'ACTIVE'\n    })\n\n    const pagination = reactive({\n      current: 1,\n      size: 10,\n      total: 0\n    })\n\n    const recordPagination = reactive({\n      current: 1,\n      size: 10,\n      total: 0\n    })\n\n    const productRules = {\n      productName: [\n        { required: true, message: '请输入商品名称', trigger: 'blur' }\n      ],\n      description: [\n        { required: true, message: '请输入商品描述', trigger: 'blur' }\n      ],\n      pointsRequired: [\n        { required: true, message: '请输入所需积分', trigger: 'blur' }\n      ],\n      stockQuantity: [\n        { required: true, message: '请输入库存数量', trigger: 'blur' }\n      ],\n      status: [\n        { required: true, message: '请选择状态', trigger: 'change' }\n      ]\n    }\n\n    const loadProducts = async () => {\n      try {\n        const params = {\n          current: pagination.current,\n          size: pagination.size,\n          keyword: filterForm.keyword || undefined\n        }\n\n        const response = await axios.get('/api/exchange/products/manage', { params })\n        if (response.data.code === 200) {\n          products.value = response.data.data.records || []\n          pagination.total = response.data.data.total || 0\n        }\n      } catch (error) {\n        ElMessage.error('获取商品列表失败')\n      }\n    }\n\n    const loadAllProducts = async () => {\n      try {\n        const response = await axios.get('/api/exchange/products')\n        if (response.data.code === 200) {\n          allProducts.value = response.data.data\n          \n          // 构建商品映射\n          allProducts.value.forEach(product => {\n            productMap.value.set(product.id, product.productName)\n          })\n        }\n      } catch (error) {\n        console.error('获取所有商品失败', error)\n      }\n    }\n\n    const loadExchangeRecords = async () => {\n      try {\n        const params = {\n          current: recordPagination.current,\n          size: recordPagination.size,\n          productId: recordFilterForm.productId || undefined,\n          keyword: recordFilterForm.keyword || undefined\n        }\n\n        if (recordFilterForm.dateRange && recordFilterForm.dateRange.length === 2) {\n          params.startDate = recordFilterForm.dateRange[0]\n          params.endDate = recordFilterForm.dateRange[1]\n        }\n\n        const response = await axios.get('/api/exchange/records/list', { params })\n        if (response.data.code === 200) {\n          exchangeRecords.value = response.data.data.records || []\n          recordPagination.total = response.data.data.total || 0\n        }\n      } catch (error) {\n        ElMessage.error('获取兑换记录失败')\n      }\n    }\n\n    const resetFilter = () => {\n      filterForm.keyword = ''\n      filterForm.status = ''\n      pagination.current = 1\n      loadProducts()\n    }\n\n    const resetRecordFilter = () => {\n      recordFilterForm.productId = ''\n      recordFilterForm.keyword = ''\n      recordFilterForm.dateRange = []\n      recordPagination.current = 1\n      loadExchangeRecords()\n    }\n\n    const handleSizeChange = (size) => {\n      pagination.size = size\n      pagination.current = 1\n      loadProducts()\n    }\n\n    const handleCurrentChange = (current) => {\n      pagination.current = current\n      loadProducts()\n    }\n\n    const handleRecordSizeChange = (size) => {\n      recordPagination.size = size\n      recordPagination.current = 1\n      loadExchangeRecords()\n    }\n\n    const handleRecordCurrentChange = (current) => {\n      recordPagination.current = current\n      loadExchangeRecords()\n    }\n\n    const handleCreateProduct = () => {\n      isEdit.value = false\n      productForm.productName = ''\n      productForm.description = ''\n      productForm.pointsRequired = null\n      productForm.stockQuantity = null\n      productForm.imageUrl = ''\n      productForm.status = 'ACTIVE'\n      productDialogVisible.value = true\n    }\n\n    const handleEditProduct = (product) => {\n      isEdit.value = true\n      Object.assign(productForm, product)\n      productDialogVisible.value = true\n    }\n\n    const handleSaveProduct = async () => {\n      try {\n        await productFormRef.value.validate()\n        \n        let response\n        if (isEdit.value) {\n          response = await axios.put(`/api/exchange/products/${productForm.id}`, productForm)\n        } else {\n          response = await axios.post('/api/exchange/products', productForm)\n        }\n        \n        if (response.data.code === 200) {\n          ElMessage.success(isEdit.value ? '更新成功' : '创建成功')\n          productDialogVisible.value = false\n          loadProducts()\n          loadAllProducts()\n        } else {\n          ElMessage.error(response.data.message || '操作失败')\n        }\n      } catch (error) {\n        ElMessage.error('操作失败')\n      }\n    }\n\n    const handleToggleStatus = async (product) => {\n      try {\n        const newStatus = product.status === 'ACTIVE' ? 'INACTIVE' : 'ACTIVE'\n        const response = await axios.put(`/api/exchange/products/${product.id}`, {\n          ...product,\n          status: newStatus\n        })\n        \n        if (response.data.code === 200) {\n          ElMessage.success(newStatus === 'ACTIVE' ? '上架成功' : '下架成功')\n          loadProducts()\n        } else {\n          ElMessage.error(response.data.message || '操作失败')\n        }\n      } catch (error) {\n        ElMessage.error('操作失败')\n      }\n    }\n\n    const handleDeleteProduct = async (product) => {\n      try {\n        await ElMessageBox.confirm(\n          `确定要删除商品 ${product.productName} 吗？`,\n          '确认删除',\n          {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }\n        )\n        \n        const response = await axios.delete(`/api/exchange/products/${product.id}`)\n        if (response.data.code === 200) {\n          ElMessage.success('删除成功')\n          loadProducts()\n          loadAllProducts()\n        } else {\n          ElMessage.error(response.data.message || '删除失败')\n        }\n      } catch (error) {\n        if (error !== 'cancel') {\n          ElMessage.error('删除失败')\n        }\n      }\n    }\n\n    const handleViewRecord = (record) => {\n      currentRecord.value = record\n      recordDialogVisible.value = true\n    }\n\n    const getProductName = (productId) => {\n      return productMap.value.get(productId) || '未知商品'\n    }\n\n    const formatTime = (time) => {\n      return new Date(time).toLocaleString()\n    }\n\n    onMounted(() => {\n      loadProducts()\n      loadAllProducts()\n      loadExchangeRecords()\n    })\n\n    return {\n      activeTab,\n      products,\n      allProducts,\n      exchangeRecords,\n      currentRecord,\n      productFormRef,\n      productDialogVisible,\n      recordDialogVisible,\n      isEdit,\n      filterForm,\n      recordFilterForm,\n      productForm,\n      pagination,\n      recordPagination,\n      productRules,\n      loadProducts,\n      loadExchangeRecords,\n      resetFilter,\n      resetRecordFilter,\n      handleSizeChange,\n      handleCurrentChange,\n      handleRecordSizeChange,\n      handleRecordCurrentChange,\n      handleCreateProduct,\n      handleEditProduct,\n      handleSaveProduct,\n      handleToggleStatus,\n      handleDeleteProduct,\n      handleViewRecord,\n      getProductName,\n      formatTime\n    }\n  }\n}\n</script>\n\n<style scoped>\n.exchange {\n  padding: 20px;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.filter-section {\n  margin-bottom: 20px;\n}\n\n.filter-form {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n}\n\n.low-stock {\n  color: #F56C6C;\n  font-weight: bold;\n}\n\n.points-used {\n  color: #F56C6C;\n  font-weight: bold;\n}\n\n.pagination {\n  margin-top: 20px;\n  text-align: center;\n}\n\n.record-detail {\n  padding: 20px 0;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}