{"ast":null,"code":"import _regenerator from \"/Users/libra520/JavaProject/repast-vip-system/frontend/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"/Users/libra520/JavaProject/repast-vip-system/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { ref, reactive, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport axios from 'axios';\nexport default {\n  name: 'MemberPoints',\n  setup: function setup() {\n    var pointRecords = ref([]);\n    var memberInfo = reactive({\n      member: {}\n    });\n    var statistics = reactive({\n      totalEarned: 0,\n      totalConsumed: 0\n    });\n    var filterForm = reactive({\n      type: '',\n      dateRange: []\n    });\n    var pagination = reactive({\n      current: 1,\n      size: 10,\n      total: 0\n    });\n    var loadMemberInfo = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n        var response, _t;\n        return _regenerator().w(function (_context) {\n          while (1) switch (_context.p = _context.n) {\n            case 0:\n              _context.p = 0;\n              _context.n = 1;\n              return axios.get('/member/profile');\n            case 1:\n              response = _context.v;\n              if (response.data.code === 200) {\n                memberInfo.member = response.data.data.member;\n              }\n              _context.n = 3;\n              break;\n            case 2:\n              _context.p = 2;\n              _t = _context.v;\n              console.error('获取会员信息失败', _t);\n            case 3:\n              return _context.a(2);\n          }\n        }, _callee, null, [[0, 2]]);\n      }));\n      return function loadMemberInfo() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    var loadPointRecords = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n        var params, response, _t2;\n        return _regenerator().w(function (_context2) {\n          while (1) switch (_context2.p = _context2.n) {\n            case 0:\n              _context2.p = 0;\n              params = {\n                current: pagination.current,\n                size: pagination.size,\n                type: filterForm.type || undefined\n              };\n              if (filterForm.dateRange && filterForm.dateRange.length === 2) {\n                params.startDate = filterForm.dateRange[0];\n                params.endDate = filterForm.dateRange[1];\n              }\n              _context2.n = 1;\n              return axios.get('/member/points', {\n                params: params\n              });\n            case 1:\n              response = _context2.v;\n              if (response.data.code === 200) {\n                pointRecords.value = response.data.data.records || response.data.data;\n                pagination.total = response.data.data.total || response.data.data.length;\n\n                // 计算统计信息\n                calculateStatistics();\n              }\n              _context2.n = 3;\n              break;\n            case 2:\n              _context2.p = 2;\n              _t2 = _context2.v;\n              ElMessage.error('获取积分记录失败');\n            case 3:\n              return _context2.a(2);\n          }\n        }, _callee2, null, [[0, 2]]);\n      }));\n      return function loadPointRecords() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var calculateStatistics = function calculateStatistics() {\n      var totalEarned = 0;\n      var totalConsumed = 0;\n      pointRecords.value.forEach(function (record) {\n        if (record.pointsChange > 0) {\n          totalEarned += record.pointsChange;\n        } else {\n          totalConsumed += Math.abs(record.pointsChange);\n        }\n      });\n      statistics.totalEarned = totalEarned;\n      statistics.totalConsumed = totalConsumed;\n    };\n    var resetFilter = function resetFilter() {\n      filterForm.type = '';\n      filterForm.dateRange = [];\n      pagination.current = 1;\n      loadPointRecords();\n    };\n    var handleSizeChange = function handleSizeChange(size) {\n      pagination.size = size;\n      pagination.current = 1;\n      loadPointRecords();\n    };\n    var handleCurrentChange = function handleCurrentChange(current) {\n      pagination.current = current;\n      loadPointRecords();\n    };\n    var formatTime = function formatTime(time) {\n      return new Date(time).toLocaleString();\n    };\n    onMounted(function () {\n      loadMemberInfo();\n      loadPointRecords();\n    });\n    return {\n      pointRecords: pointRecords,\n      memberInfo: memberInfo,\n      statistics: statistics,\n      filterForm: filterForm,\n      pagination: pagination,\n      loadPointRecords: loadPointRecords,\n      resetFilter: resetFilter,\n      handleSizeChange: handleSizeChange,\n      handleCurrentChange: handleCurrentChange,\n      formatTime: formatTime\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","ElMessage","axios","name","setup","pointRecords","memberInfo","member","statistics","totalEarned","totalConsumed","filterForm","type","dateRange","pagination","current","size","total","loadMemberInfo","_ref","_asyncToGenerator","_regenerator","m","_callee","response","_t","w","_context","p","n","get","v","data","code","console","error","a","apply","arguments","loadPointRecords","_ref2","_callee2","params","_t2","_context2","undefined","length","startDate","endDate","value","records","calculateStatistics","forEach","record","pointsChange","Math","abs","resetFilter","handleSizeChange","handleCurrentChange","formatTime","time","Date","toLocaleString"],"sources":["/Users/libra520/JavaProject/repast-vip-system/frontend/src/views/member/Points.vue"],"sourcesContent":["<template>\n  <div class=\"points\">\n    <el-card>\n      <template #header>\n        <div class=\"card-header\">\n          <span>积分记录</span>\n          <div class=\"points-summary\">\n            <span>可用积分：</span>\n            <span class=\"points-value\">{{ memberInfo.member?.availablePoints || 0 }}</span>\n          </div>\n        </div>\n      </template>\n\n      <!-- 筛选条件 -->\n      <div class=\"filter-section\">\n        <el-form :inline=\"true\" :model=\"filterForm\" class=\"filter-form\">\n          <el-form-item label=\"类型\">\n            <el-select v-model=\"filterForm.type\" placeholder=\"全部类型\" clearable style=\"width: 150px\">\n              <el-option label=\"获得积分\" value=\"EARN\" />\n              <el-option label=\"消费积分\" value=\"CONSUME\" />\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"时间范围\">\n            <el-date-picker\n              v-model=\"filterForm.dateRange\"\n              type=\"daterange\"\n              range-separator=\"至\"\n              start-placeholder=\"开始日期\"\n              end-placeholder=\"结束日期\"\n              format=\"YYYY-MM-DD\"\n              value-format=\"YYYY-MM-DD\"\n            />\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"loadPointRecords\">查询</el-button>\n            <el-button @click=\"resetFilter\">重置</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n\n      <!-- 积分记录列表 -->\n      <el-table :data=\"pointRecords\" style=\"width: 100%\">\n        <el-table-column prop=\"description\" label=\"描述\" min-width=\"200\" />\n        <el-table-column prop=\"type\" label=\"类型\" width=\"100\">\n          <template #default=\"scope\">\n            <el-tag :type=\"scope.row.type === 'EARN' ? 'success' : 'danger'\">\n              {{ scope.row.type === 'EARN' ? '获得' : '消费' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"pointsChange\" label=\"积分变化\" width=\"120\">\n          <template #default=\"scope\">\n            <span :class=\"{ 'positive': scope.row.pointsChange > 0, 'negative': scope.row.pointsChange < 0 }\">\n              {{ scope.row.pointsChange > 0 ? '+' : '' }}{{ scope.row.pointsChange }}\n            </span>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"createTime\" label=\"时间\" width=\"180\">\n          <template #default=\"scope\">\n            {{ formatTime(scope.row.createTime) }}\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <!-- 分页 -->\n      <div class=\"pagination\">\n        <el-pagination\n          v-model:current-page=\"pagination.current\"\n          v-model:page-size=\"pagination.size\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          :total=\"pagination.total\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n\n      <div v-if=\"pointRecords.length === 0\" class=\"no-data\">\n        暂无积分记录\n      </div>\n    </el-card>\n\n    <!-- 统计信息 -->\n    <el-row :gutter=\"20\" style=\"margin-top: 20px;\">\n      <el-col :span=\"8\">\n        <el-card class=\"stat-card\">\n          <div class=\"stat-item\">\n            <div class=\"stat-value positive\">{{ statistics.totalEarned || 0 }}</div>\n            <div class=\"stat-label\">总获得积分</div>\n          </div>\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card class=\"stat-card\">\n          <div class=\"stat-item\">\n            <div class=\"stat-value negative\">{{ statistics.totalConsumed || 0 }}</div>\n            <div class=\"stat-label\">总消费积分</div>\n          </div>\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card class=\"stat-card\">\n          <div class=\"stat-item\">\n            <div class=\"stat-value\">{{ memberInfo.member?.totalPoints || 0 }}</div>\n            <div class=\"stat-label\">累计总积分</div>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport axios from 'axios'\n\nexport default {\n  name: 'MemberPoints',\n  setup() {\n    const pointRecords = ref([])\n    const memberInfo = reactive({ member: {} })\n    const statistics = reactive({\n      totalEarned: 0,\n      totalConsumed: 0\n    })\n\n    const filterForm = reactive({\n      type: '',\n      dateRange: []\n    })\n\n    const pagination = reactive({\n      current: 1,\n      size: 10,\n      total: 0\n    })\n\n    const loadMemberInfo = async () => {\n      try {\n        const response = await axios.get('/member/profile')\n        if (response.data.code === 200) {\n          memberInfo.member = response.data.data.member\n        }\n      } catch (error) {\n        console.error('获取会员信息失败', error)\n      }\n    }\n\n    const loadPointRecords = async () => {\n      try {\n        const params = {\n          current: pagination.current,\n          size: pagination.size,\n          type: filterForm.type || undefined\n        }\n\n        if (filterForm.dateRange && filterForm.dateRange.length === 2) {\n          params.startDate = filterForm.dateRange[0]\n          params.endDate = filterForm.dateRange[1]\n        }\n\n        const response = await axios.get('/member/points', { params })\n        if (response.data.code === 200) {\n          pointRecords.value = response.data.data.records || response.data.data\n          pagination.total = response.data.data.total || response.data.data.length\n          \n          // 计算统计信息\n          calculateStatistics()\n        }\n      } catch (error) {\n        ElMessage.error('获取积分记录失败')\n      }\n    }\n\n    const calculateStatistics = () => {\n      let totalEarned = 0\n      let totalConsumed = 0\n\n      pointRecords.value.forEach(record => {\n        if (record.pointsChange > 0) {\n          totalEarned += record.pointsChange\n        } else {\n          totalConsumed += Math.abs(record.pointsChange)\n        }\n      })\n\n      statistics.totalEarned = totalEarned\n      statistics.totalConsumed = totalConsumed\n    }\n\n    const resetFilter = () => {\n      filterForm.type = ''\n      filterForm.dateRange = []\n      pagination.current = 1\n      loadPointRecords()\n    }\n\n    const handleSizeChange = (size) => {\n      pagination.size = size\n      pagination.current = 1\n      loadPointRecords()\n    }\n\n    const handleCurrentChange = (current) => {\n      pagination.current = current\n      loadPointRecords()\n    }\n\n    const formatTime = (time) => {\n      return new Date(time).toLocaleString()\n    }\n\n    onMounted(() => {\n      loadMemberInfo()\n      loadPointRecords()\n    })\n\n    return {\n      pointRecords,\n      memberInfo,\n      statistics,\n      filterForm,\n      pagination,\n      loadPointRecords,\n      resetFilter,\n      handleSizeChange,\n      handleCurrentChange,\n      formatTime\n    }\n  }\n}\n</script>\n\n<style scoped>\n.points {\n  padding: 20px;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.points-summary {\n  color: #666;\n}\n\n.points-value {\n  color: #409EFF;\n  font-weight: bold;\n  font-size: 18px;\n}\n\n.filter-section {\n  margin-bottom: 20px;\n}\n\n.filter-form {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n}\n\n.positive {\n  color: #67C23A;\n  font-weight: bold;\n}\n\n.negative {\n  color: #F56C6C;\n  font-weight: bold;\n}\n\n.pagination {\n  margin-top: 20px;\n  text-align: center;\n}\n\n.no-data {\n  text-align: center;\n  color: #909399;\n  padding: 40px;\n}\n\n.stat-card {\n  text-align: center;\n}\n\n.stat-item {\n  padding: 20px;\n}\n\n.stat-value {\n  font-size: 28px;\n  font-weight: bold;\n  margin-bottom: 10px;\n}\n\n.stat-label {\n  color: #666;\n  font-size: 14px;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}