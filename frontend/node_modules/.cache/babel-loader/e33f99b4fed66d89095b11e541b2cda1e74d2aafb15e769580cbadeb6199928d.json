{"ast":null,"code":"import { ref, reactive, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport axios from 'axios';\nexport default {\n  name: 'MemberProfile',\n  setup() {\n    const memberInfo = ref({});\n    const editDialogVisible = ref(false);\n    const passwordLoading = ref(false);\n    const passwordFormRef = ref();\n    const editFormRef = ref();\n    const passwordForm = reactive({\n      oldPassword: '',\n      newPassword: '',\n      confirmPassword: ''\n    });\n    const editForm = reactive({\n      username: '',\n      phone: '',\n      email: ''\n    });\n    const validateConfirmPassword = (rule, value, callback) => {\n      if (value !== passwordForm.newPassword) {\n        callback(new Error('两次输入的密码不一致'));\n      } else {\n        callback();\n      }\n    };\n    const passwordRules = {\n      oldPassword: [{\n        required: true,\n        message: '请输入当前密码',\n        trigger: 'blur'\n      }],\n      newPassword: [{\n        required: true,\n        message: '请输入新密码',\n        trigger: 'blur'\n      }, {\n        min: 6,\n        max: 20,\n        message: '密码长度在 6 到 20 个字符',\n        trigger: 'blur'\n      }],\n      confirmPassword: [{\n        required: true,\n        message: '请确认新密码',\n        trigger: 'blur'\n      }, {\n        validator: validateConfirmPassword,\n        trigger: 'blur'\n      }]\n    };\n    const editRules = {\n      phone: [{\n        required: true,\n        message: '请输入手机号',\n        trigger: 'blur'\n      }, {\n        pattern: /^1[3-9]\\d{9}$/,\n        message: '请输入正确的手机号',\n        trigger: 'blur'\n      }],\n      email: [{\n        required: true,\n        message: '请输入邮箱',\n        trigger: 'blur'\n      }, {\n        type: 'email',\n        message: '请输入正确的邮箱格式',\n        trigger: 'blur'\n      }]\n    };\n    const loadMemberInfo = async () => {\n      try {\n        const response = await axios.get('/api/member/profile');\n        if (response.data.code === 200) {\n          memberInfo.value = response.data.data;\n        }\n      } catch (error) {\n        ElMessage.error('获取会员信息失败');\n      }\n    };\n    const handleEdit = () => {\n      editForm.username = memberInfo.value.user?.username;\n      editForm.phone = memberInfo.value.user?.phone;\n      editForm.email = memberInfo.value.user?.email;\n      editDialogVisible.value = true;\n    };\n    const handleSaveEdit = async () => {\n      try {\n        await editFormRef.value.validate();\n        const response = await axios.put('/api/member/profile', {\n          phone: editForm.phone,\n          email: editForm.email\n        });\n        if (response.data.code === 200) {\n          ElMessage.success('更新成功');\n          editDialogVisible.value = false;\n          loadMemberInfo();\n        } else {\n          ElMessage.error(response.data.message || '更新失败');\n        }\n      } catch (error) {\n        ElMessage.error('更新失败');\n      }\n    };\n    const handleChangePassword = async () => {\n      try {\n        await passwordFormRef.value.validate();\n        passwordLoading.value = true;\n        const response = await axios.post('/api/auth/change-password', {\n          oldPassword: passwordForm.oldPassword,\n          newPassword: passwordForm.newPassword\n        });\n        if (response.data.code === 200) {\n          ElMessage.success('密码修改成功');\n          // 清空表单\n          passwordForm.oldPassword = '';\n          passwordForm.newPassword = '';\n          passwordForm.confirmPassword = '';\n        } else {\n          ElMessage.error(response.data.message || '密码修改失败');\n        }\n      } catch (error) {\n        ElMessage.error(error.response?.data?.message || '密码修改失败');\n      } finally {\n        passwordLoading.value = false;\n      }\n    };\n    const getLevelText = level => {\n      const levelMap = {\n        'BRONZE': '青铜会员',\n        'SILVER': '白银会员',\n        'GOLD': '黄金会员',\n        'PLATINUM': '铂金会员'\n      };\n      return levelMap[level] || '普通会员';\n    };\n    const getLevelTagType = level => {\n      const typeMap = {\n        'BRONZE': 'info',\n        'SILVER': '',\n        'GOLD': 'warning',\n        'PLATINUM': 'success'\n      };\n      return typeMap[level] || 'info';\n    };\n    const formatTime = time => {\n      return new Date(time).toLocaleString();\n    };\n    onMounted(() => {\n      loadMemberInfo();\n    });\n    return {\n      memberInfo,\n      editDialogVisible,\n      passwordLoading,\n      passwordForm,\n      editForm,\n      passwordFormRef,\n      editFormRef,\n      passwordRules,\n      editRules,\n      handleEdit,\n      handleSaveEdit,\n      handleChangePassword,\n      getLevelText,\n      getLevelTagType,\n      formatTime\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","ElMessage","axios","name","setup","memberInfo","editDialogVisible","passwordLoading","passwordFormRef","editFormRef","passwordForm","oldPassword","newPassword","confirmPassword","editForm","username","phone","email","validateConfirmPassword","rule","value","callback","Error","passwordRules","required","message","trigger","min","max","validator","editRules","pattern","type","loadMemberInfo","response","get","data","code","error","handleEdit","user","handleSaveEdit","validate","put","success","handleChangePassword","post","getLevelText","level","levelMap","getLevelTagType","typeMap","formatTime","time","Date","toLocaleString"],"sources":["/Users/libra520/JavaProject/repast-vip-system/frontend/src/views/member/Profile.vue"],"sourcesContent":["<template>\n  <div class=\"profile\">\n    <el-card>\n      <template #header>\n        <div class=\"card-header\">\n          <span>个人资料</span>\n          <el-button type=\"primary\" @click=\"handleEdit\">编辑资料</el-button>\n        </div>\n      </template>\n\n      <div class=\"profile-content\">\n        <el-row :gutter=\"20\">\n          <el-col :span=\"8\">\n            <div class=\"avatar-section\">\n              <el-avatar :size=\"120\" icon=\"User\" />\n              <h3>{{ memberInfo.user?.username }}</h3>\n              <el-tag :type=\"getLevelTagType(memberInfo.member?.level)\">\n                {{ getLevelText(memberInfo.member?.level) }}\n              </el-tag>\n            </div>\n          </el-col>\n          <el-col :span=\"16\">\n            <div class=\"info-section\">\n              <el-descriptions :column=\"2\" border>\n                <el-descriptions-item label=\"会员号\">{{ memberInfo.member?.memberCode }}</el-descriptions-item>\n                <el-descriptions-item label=\"用户名\">{{ memberInfo.user?.username }}</el-descriptions-item>\n                <el-descriptions-item label=\"手机号\">{{ memberInfo.user?.phone }}</el-descriptions-item>\n                <el-descriptions-item label=\"邮箱\">{{ memberInfo.user?.email }}</el-descriptions-item>\n                <el-descriptions-item label=\"总积分\">{{ memberInfo.member?.totalPoints }}</el-descriptions-item>\n                <el-descriptions-item label=\"可用积分\">{{ memberInfo.member?.availablePoints }}</el-descriptions-item>\n                <el-descriptions-item label=\"注册时间\" :span=\"2\">{{ formatTime(memberInfo.member?.createTime) }}</el-descriptions-item>\n                <el-descriptions-item label=\"最后更新\" :span=\"2\">{{ formatTime(memberInfo.member?.updateTime) }}</el-descriptions-item>\n              </el-descriptions>\n            </div>\n          </el-col>\n        </el-row>\n      </div>\n    </el-card>\n\n    <!-- 修改密码 -->\n    <el-card style=\"margin-top: 20px;\">\n      <template #header>\n        <span>修改密码</span>\n      </template>\n      <el-form :model=\"passwordForm\" :rules=\"passwordRules\" ref=\"passwordFormRef\" label-width=\"100px\" style=\"max-width: 500px;\">\n        <el-form-item label=\"当前密码\" prop=\"oldPassword\">\n          <el-input v-model=\"passwordForm.oldPassword\" type=\"password\" show-password />\n        </el-form-item>\n        <el-form-item label=\"新密码\" prop=\"newPassword\">\n          <el-input v-model=\"passwordForm.newPassword\" type=\"password\" show-password />\n        </el-form-item>\n        <el-form-item label=\"确认密码\" prop=\"confirmPassword\">\n          <el-input v-model=\"passwordForm.confirmPassword\" type=\"password\" show-password />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleChangePassword\" :loading=\"passwordLoading\">\n            修改密码\n          </el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n\n    <!-- 编辑资料对话框 -->\n    <el-dialog v-model=\"editDialogVisible\" title=\"编辑个人资料\" width=\"50%\">\n      <el-form :model=\"editForm\" :rules=\"editRules\" ref=\"editFormRef\" label-width=\"100px\">\n        <el-form-item label=\"用户名\" prop=\"username\">\n          <el-input v-model=\"editForm.username\" disabled />\n        </el-form-item>\n        <el-form-item label=\"手机号\" prop=\"phone\">\n          <el-input v-model=\"editForm.phone\" />\n        </el-form-item>\n        <el-form-item label=\"邮箱\" prop=\"email\">\n          <el-input v-model=\"editForm.email\" />\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"editDialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleSaveEdit\">保存</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport axios from 'axios'\n\nexport default {\n  name: 'MemberProfile',\n  setup() {\n    const memberInfo = ref({})\n    const editDialogVisible = ref(false)\n    const passwordLoading = ref(false)\n    const passwordFormRef = ref()\n    const editFormRef = ref()\n\n    const passwordForm = reactive({\n      oldPassword: '',\n      newPassword: '',\n      confirmPassword: ''\n    })\n\n    const editForm = reactive({\n      username: '',\n      phone: '',\n      email: ''\n    })\n\n    const validateConfirmPassword = (rule, value, callback) => {\n      if (value !== passwordForm.newPassword) {\n        callback(new Error('两次输入的密码不一致'))\n      } else {\n        callback()\n      }\n    }\n\n    const passwordRules = {\n      oldPassword: [\n        { required: true, message: '请输入当前密码', trigger: 'blur' }\n      ],\n      newPassword: [\n        { required: true, message: '请输入新密码', trigger: 'blur' },\n        { min: 6, max: 20, message: '密码长度在 6 到 20 个字符', trigger: 'blur' }\n      ],\n      confirmPassword: [\n        { required: true, message: '请确认新密码', trigger: 'blur' },\n        { validator: validateConfirmPassword, trigger: 'blur' }\n      ]\n    }\n\n    const editRules = {\n      phone: [\n        { required: true, message: '请输入手机号', trigger: 'blur' },\n        { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号', trigger: 'blur' }\n      ],\n      email: [\n        { required: true, message: '请输入邮箱', trigger: 'blur' },\n        { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' }\n      ]\n    }\n\n    const loadMemberInfo = async () => {\n      try {\n        const response = await axios.get('/api/member/profile')\n        if (response.data.code === 200) {\n          memberInfo.value = response.data.data\n        }\n      } catch (error) {\n        ElMessage.error('获取会员信息失败')\n      }\n    }\n\n    const handleEdit = () => {\n      editForm.username = memberInfo.value.user?.username\n      editForm.phone = memberInfo.value.user?.phone\n      editForm.email = memberInfo.value.user?.email\n      editDialogVisible.value = true\n    }\n\n    const handleSaveEdit = async () => {\n      try {\n        await editFormRef.value.validate()\n        \n        const response = await axios.put('/api/member/profile', {\n          phone: editForm.phone,\n          email: editForm.email\n        })\n        \n        if (response.data.code === 200) {\n          ElMessage.success('更新成功')\n          editDialogVisible.value = false\n          loadMemberInfo()\n        } else {\n          ElMessage.error(response.data.message || '更新失败')\n        }\n      } catch (error) {\n        ElMessage.error('更新失败')\n      }\n    }\n\n    const handleChangePassword = async () => {\n      try {\n        await passwordFormRef.value.validate()\n        passwordLoading.value = true\n\n        const response = await axios.post('/api/auth/change-password', {\n          oldPassword: passwordForm.oldPassword,\n          newPassword: passwordForm.newPassword\n        })\n\n        if (response.data.code === 200) {\n          ElMessage.success('密码修改成功')\n          // 清空表单\n          passwordForm.oldPassword = ''\n          passwordForm.newPassword = ''\n          passwordForm.confirmPassword = ''\n        } else {\n          ElMessage.error(response.data.message || '密码修改失败')\n        }\n      } catch (error) {\n        ElMessage.error(error.response?.data?.message || '密码修改失败')\n      } finally {\n        passwordLoading.value = false\n      }\n    }\n\n    const getLevelText = (level) => {\n      const levelMap = {\n        'BRONZE': '青铜会员',\n        'SILVER': '白银会员',\n        'GOLD': '黄金会员',\n        'PLATINUM': '铂金会员'\n      }\n      return levelMap[level] || '普通会员'\n    }\n\n    const getLevelTagType = (level) => {\n      const typeMap = {\n        'BRONZE': 'info',\n        'SILVER': '',\n        'GOLD': 'warning',\n        'PLATINUM': 'success'\n      }\n      return typeMap[level] || 'info'\n    }\n\n    const formatTime = (time) => {\n      return new Date(time).toLocaleString()\n    }\n\n    onMounted(() => {\n      loadMemberInfo()\n    })\n\n    return {\n      memberInfo,\n      editDialogVisible,\n      passwordLoading,\n      passwordForm,\n      editForm,\n      passwordFormRef,\n      editFormRef,\n      passwordRules,\n      editRules,\n      handleEdit,\n      handleSaveEdit,\n      handleChangePassword,\n      getLevelText,\n      getLevelTagType,\n      formatTime\n    }\n  }\n}\n</script>\n\n<style scoped>\n.profile {\n  padding: 20px;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.profile-content {\n  padding: 20px 0;\n}\n\n.avatar-section {\n  text-align: center;\n}\n\n.avatar-section h3 {\n  margin: 20px 0 10px 0;\n  color: #303133;\n}\n\n.info-section {\n  padding: 0 20px;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}